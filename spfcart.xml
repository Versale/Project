<?xml version="1.0" encoding="UTF-8"?>
<modification>
	<id>Cart Plus Minus</id>
	<version>1.0</version>
	<vqmver>2.1.7</vqmver>
	<author></author>

	<file name="catalog/view/theme/*/template/common/header.tpl">
		<operation>
			<search position="before"><![CDATA[</head>]]></search>
			<add><![CDATA[
			<script>
                $(document).ready(function(){
                    $('#button-cart').unbind('click');
                    $('#button-cart').bind('click', function () { addToCart();});
                    $('#cart-total').unbind('click');
                    $('#cart-total').bind('click', function () {  
	                    $.ajax({
	                        url: 'index.php?route=checkout/cart',
	                        success: function(json) {
                               $('#cart-total, .cart-total').html(json['total']);
                               $('#cartpopup_1 .cart').load('index.php?route=checkout/cart .mini-cart-info', function() {
                                	
                                });
                                $.colorbox({
                                	inline:true,
                                	href:'#cartpopup_1',
                                	onComplete:function(){
                            			$('#cartpopup_1').css({'opacity':1, 'visibility':'visible'});
                                	}
                                });
	                        }  
	                    });
	                    return false;
                    });

                });


                function addToCart(product_id, quantity) {
                    var productpage = true;
                
                    if (typeof(product_id) != 'undefined') {
                        var productpage = false;
                        var quantity = typeof(quantity) != 'undefined' ? quantity : 1;
                        var data = 'product_id=' + product_id + '&quantity=' + quantity;
                    } else {
                        var quantity = $('input[name=\'quantity\']').val();
                        var data =  $('.product-info input[type=\'text\'], .product-info input[type=\'hidden\'], .product-info input[               type=\'radio\']:checked, .product-info input[type=\'checkbox\']:checked, .product-info select, .product-info            textarea');
                    }
                	console.log(declination(parseInt(quantity)));
                    $('#text-added').text(quantity + ' '+declination(parseInt(quantity)));
                    
                    $.ajax({
                        url: 'index.php?route=checkout/cart/add',
                        type: 'post',
                        data: data,
                        dataType: 'json',
                        success: function(json) {
                            $('.success, .warning, .attention, .information, .error').remove();
                            
                            if (json['redirect'] && !productpage) {
                                location = json['redirect'];
                            }
                
                            if (json['error'] && productpage) {
                                if (json['error']['option']) {
                                    for (i in json['error']['option']) {
                                        $('#option-' + i).after('<span class="error">' + json['error']['option'][i] + '</span>');
                                    }
                                }
                            } 
                            
                            if (json['success']) {
                                $('#cart-total, .cart-total').html(json['total']);

                                $('#cartpopup .cart').load('index.php?route=checkout/cart .mini-cart-info', function() {
                                	
                                });
                                $.colorbox({
                                	inline:true,
                                	href:'#cartpopup',
                                	onComplete:function(){
                            			$('#cartpopup').css({'opacity':1, 'visibility':'visible'});
                                	}
                                });
                            }  

                        }
                    });
                }
            </script>
			]]></add>
		</operation>
        
	</file>
		
	<file name="catalog/view/theme/*/template/checkout/cart.tpl">
		<operation>
			<search position="before"><![CDATA[</head>]]></search>
			<add><![CDATA[
		<div id="cart">
		  <div class="heading">
		    <a title="<?php echo $heading_title; ?>"><span id="cart-total"><?php echo $text_items; ?></span></a></div>
		  <div class="content">
		    <?php if ($products || $vouchers) { ?>
		    <div class="mini-cart-info">
		      <table>
		        <?php foreach ($products as $product) { ?>
		        <tr>
		          <td class="image"><?php if ($product['thumb']) { ?>
		            <a href="<?php echo $product['href']; ?>"><img src="<?php echo $product['thumb']; ?>" alt="<?php 			echo $product['name']; ?>" title="<?php echo $product['name']; ?>" /></a>
		            <?php } ?></td>
		          <td class="name"><a href="<?php echo $product['href']; ?>"><?php echo $product['name']; ?></a>
		            <div>
		              <?php foreach ($product['option'] as $option) { ?>
		              - <small><?php echo $option['name']; ?> <?php echo $option['value']; ?></small><br />
		              <?php } ?>
		            </div></td>
		          <td class="quantity">x&nbsp;<?php echo $product['quantity']; ?></td>
		          <td class="total"><?php echo $product['total']; ?></td>
		          <td class="remove"><img src="catalog/view/theme/default/image/remove-small.png" alt="<?php echo $button_remove; ?>" title="<?php echo $button_remove; ?>" onclick="(getURLVar('route') == 'checkout/cart' || getURLVar('route') == 'checkout/checkout') ? location = 'index.php?route=checkout/cart&remove=<?php echo $product['key']; ?>' : $('#cart').load('index.php?route=checkout/cart&remove=<?php echo $product['key']; ?>' + ' #cart > *');" /></td>
		        </tr>
		        <?php } ?>
		        <?php foreach ($vouchers as $voucher) { ?>
		        <tr>
		          <td class="image"></td>
		          <td class="name"><?php echo $voucher['description']; ?></td>
		          <td class="quantity">x&nbsp;1</td>
		          <td class="total"><?php echo $voucher['amount']; ?></td>
		          <td class="remove"><img src="catalog/view/theme/default/image/remove-small.png" alt="<?php echo $button_remove; ?>" title="<?php echo $button_remove; ?>" onclick="(getURLVar('route') == 'checkout/cart' || getURLVar('route') == 'checkout/checkout') ? location = 'index.php?route=checkout/cart&remove=<?php echo $voucher['key']; ?>' : $('#cart').load('index.php?route=checkout/cart&remove=<?php echo $voucher['key']; ?>' + ' #cart > *');" /></td>
		        </tr>
		        <?php } ?>
		      </table>
		    </div>
		    <div class="mini-cart-total">
		      <table>
		        <?php foreach ($totals as $total) { ?>
		        <tr>
		          <td class="right"><b><?php echo $total['title']; ?>:</b></td>
		          <td class="right"><?php echo $total['text']; ?></td>
		        </tr>
		        <?php } ?>
		      </table>
		    </div>
		    <div class="checkout"><a href="<?php echo $cart; ?>"><?php echo $text_cart; ?></a> | <a href="<?php echo $	checkout; ?>"><?php echo $text_checkout; ?></a></div>
		    <?php } else { ?>
		    <div class="empty"><?php echo $text_empty; ?></div>
		    <?php } ?>
		  </div>
		</div>	
		]]></add>
	</operation>
	</file>


</modification>